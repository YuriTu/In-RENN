# MATRIX项目前端文档  

## 目前版本：1.5.0

## 新人指南
 1. 项目基于ES6 + React + Webpack 搭建, 兼容IE8+.
 2. 项目所有依赖写在package.json文件中, 需要先使用 npm install 安装项目的所有依赖.PS:安装需要Xcode并给予管理权限
 3. 运行 npm run dev 进入开发环境. 会通过webpack-dev-server启动一个本地server, 支持代码热更替.
 4. 本地开发的 host : 127.0.0.1 static.sofund.com matrix.sofund.com
    1. 新版本的开发静态url是static.sofund.com,而实际的接口的请求该是matrix.sofund.com
    2. 所有的异步请求由本地 127.0.0.1:9001 发起,通过nginx转发到相应的后端接口，目的是实现前后端的真正分离
 5. 需要 [更新 nginx的配置](#nginx) 以解决跨域问题
 6. 如果提交代码时git 报错为 `error  Unexpected token cons  undefined` ,请执行git commit -m “sometext” --no-verify
 7. 开发的时候对照着 matrix视觉规范.psd
 8. 代码提交的时候以组件为单位进行提交,并且提交代码审查，
 9. arc land 出现revision错误且无法合并至matrix分支时,
    请在 /usr/local/lib/node_modules/arcanist/arcanist/src/land/ArcanistGitlandEngine.php 文件中,186行添加 no-verify
 10. 基于组件化思想,开发前请 注意一下common文件下下的组件，以及common.scss ，灵活复用组件加快开发速度
 
##开发简易流程
1. 组件文件位置: 全站公共的组件位于 ./src/components/common 文件夹中,页面的私有组件请写到页面相对应的文件夹下。
2. 入口文件:  入口文件为每个页面对应下的app.js。例如首页的入口文件为 ./src/components/index/app.js 请根据产品需求在render中添加组件。
3. 页面预览入口: 在启动webpack服务后,会得到开发IP地址(0.0.0.0:9001 或者 127.0.0.1:9001) 页面预览地址为 : domain/src/tmpl
4. 异步请求规范: AJAX 请求使用封装的 ../components/common/service/service.js 在使用时在文件开头import
5. 图标: 所有的图标使用`字体图标`(禁止使用雪碧图),字体文件位于 fonts文件夹内,图标使用请先提交至相关同学处进行制作字体文件,开发过程中先用其他图标代替。
6. 新组件的添加
    1. 在webpack.config中添加新的entry
    2. 在 ./tmpl 中添加对应的html文件,引入 *.bundle.js
7. IE8测试: host绑定真机ip,页面预览同为domain/src/tmpl,IE8浏览器关闭遇错停止选项,IE11模拟8选择跳过错误。
    1.IE8的接口无数据问题:必须采用相对路径,请按照server.js中的规范进行接口书写,并更改nginx设置
8. 提交代码审查

##代码审查流程
1. 使用npm 安装  Arcanist npm install -g arcanist
2. 添加证书 请仔细阅读命令行提示进行...
    arc install-certificate 安装证书
    如果报错
        执行security add-trusted-cert
        如果还报错
            执行security add-trusted-cert -D
        
    再执行 arc install-certificate
    根据命令行,会要求你去一个网站,并登录phabricator 会获得一串认证字符
    就根据提示输入回 命令行即可
3. 审查流程
    1. 开分支: git checkout -b xxx 本地开一个独立分支
    2. 交代码: git commit
    3. 提审查: arc diff matrix   合并分支指定为matrix 即为arc diff matrix,否则会造成将所有的commit指定至master。
        PS:arc land 完成之前,不要提交新的commit与diff
    4. 合分支: 审核通过后执行 arc land --onto matrix 把本地代码合并到远端matrix分支


##webpack规范
1. require模块时,不要直接从node_module中取文件,在webpack中的alias添加后进行require

<h2 id="nginx">nginx配置的更改</h2>
请在nginx.conf 中添加新的server
代码如下:  `请务必核对文件路径是否与自身路径符合`
此处监听了2个url,原因是--》 新人指南4.1
```
#将此server置于第一个server,以解决IE8接口数据问题

server {
      listen       80;
      server_name  matrix.sofund.com;
      charset utf-8;
      # 静态SVN发布仓库地址
      autoindex       on;
      autoindex_exact_size    on;
      
      location / {
          add_header "Access-Control-Allow-Origin" "*";
          expires 1M;
          access_log off;
          add_header Cache-Control "public";
          proxy_set_header x-request-filename $request_filename;
          proxy_set_header Cookie "_T=1gGid1Vw; _I=3; JSESSIONID=673B88B560565E23F8261C5D83999323";
          proxy_pass ht tp://10.4.32.134:9000;         
      }
    }





server {

  listen       80;
  server_name  static.matrix.com;
  charset utf-8;
  # 静态SVN发布仓库地址
  autoindex       on;
  autoindex_exact_size    on;


  location / {
      root /Users/renren/workspace/gitrepos/external-matrix/MATRIX/dist;
  }

  location /js {
      proxy_set_header x-request-filename $request_filename;
      proxy_pass http://127.0.0.1:9001;
  }

  location ~* \.(?:ttf|eot|woff)$ { #|ttc|otf
      add_header "Access-Control-Allow-Origin" "*";
      root /Users/renren/workspace/gitrepos/external-matrix/MATRIX/dist;
  }

}



```

## IE8兼容性问题:
解决方案详情见:
[Make your React app work in IE8][1]
[react 项目的一个ie8兼容性问题][3]
![es6通过babel转译后,需要兼容IE8时的常见问题][2]

  [1]: https://github.com/xcatliu/react-ie8
  [2]: http://7xt4ft.com2.z0.glb.clouddn.com/react-ie8.png
  [3]: http://www.aliued.com/?p=3240
